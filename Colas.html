<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador Interactivo de Cola (Queue) - FIFO</title>
    <link rel="icon" href="LogoUT.png">
    <style>
        
        /* Fuentes */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700&display=swap');

        /* --- Estilos Generales --- */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5; 
            color: #333;
            line-height: 1.6;
        }

        header {
            background-color: #2c3e50; 
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25); 
            margin-bottom: 20px;
        }

        header h1 {
            font-family: 'Montserrat', sans-serif;
            margin-top: 0;
            font-size: 3em; 
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
            max-width: 800px;
            margin: 10px auto 0;
        }
        
        /* Contenedor de la Teor√≠a */
        .teoria-container {
            background-color: #ffffff; 
            padding: 30px;
            margin: 20px auto;
            max-width: 1100px; 
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.8s ease-out; 
        }
        
        .teoria-container h2 {
            color: #34495e; 
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            text-align: center;
        }

        .teoria-container h3 {
            color: #2c3e50;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4em;
            margin-top: 30px;
            padding-left: 10px;
            border-left: 5px solid #3498db;
        }
        
        .teoria-container p {
            font-size: 1.05em;
            margin-bottom: 15px;
            text-align: justify;
        }

        .teoria-container strong {
            color: #e74c3c; 
            font-weight: 700;
        }
        
        /* Contenedor de las Tarjetas de Conceptos */
        .conceptos-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px;
            margin-top: 30px;
        }
        
        .concepto-card {
            background-color: #f9f9f9; 
            padding: 20px;
            border-left: 6px solid #2ecc71; 
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, background-color 0.3s ease;
        }

        .concepto-card.error-card {
            border-left: 6px solid #e74c3c; 
        }
        
        .concepto-card:hover {
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            background-color: #e8f4fd; 
            cursor: default;
        }

        .concepto-card h4 {
            margin-top: 0;
            color: #2c3e50; 
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .concepto-card p {
            font-size: 1em;
            margin: 0;
            color: #555;
            text-align: left; 
        }

        hr {
            border: none;
            border-top: 1px solid #e0e0e0;
            margin: 30px 0;
        }

        main {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; 
            padding: 30px 20px;
            gap: 30px;
            max-width: 1100px;
            margin: 0 auto 50px auto;
        }

        .visualizador, .controles {
            background-color: white;
            padding: 35px; 
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 350px; 
            max-width: 500px; 
        }

        h2.section-title { 
            font-family: 'Montserrat', sans-serif;
            color: #3498db; 
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 30px;
            font-size: 2em;
            text-align: center;
        }

        /* --- Visualizaci√≥n de la Cola (Contenedor MEJORADO) --- */
        .cola-wrapper {
            position: relative;
            margin: 20px auto 40px;
            width: 100%;
            max-width: 600px;
            height: 150px; 
            display: flex;
            align-items: center; 
            justify-content: center;
        }
        
        /* El contenedor principal act√∫a como el "t√∫nel" de la cola */
        .cola {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            
            border: 3px solid #7f8c8d; 
            border-radius: 8px;
            height: 100px; 
            width: 100%; 
            background-color: #ecf0f1; 
            overflow: hidden; 
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.15); 
            position: relative;
            padding: 5px; 
            box-sizing: border-box;
        }
        
        /* Contenedor interno que contiene los elementos */
        #cola-contenedor-interno {
            display: flex;
            align-items: center;
            transition: none; 
        }

        .elemento {
            min-width: 80px; 
            max-width: 80px;
            height: 80px; 
            padding: 5px; 
            margin: 0 5px; 
            background-color: #2ecc71; 
            color: white;
            text-align: center;
            border: 1px solid #27ae60;
            border-radius: 5px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
            font-weight: 600;
            line-height: 70px;
            transition: all 0.4s ease-in-out, background-color 0.2s, transform 0.4s, width 0.4s, margin 0.4s; 
            z-index: 5;
            font-size: 1.1em;
            flex-shrink: 0; 
            box-sizing: border-box;
        }
        
        /* Marcadores visuales de Frente y Final */
        .elemento.frente {
            background-color: #e74c3c; 
            color: white;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.9);
        }

        .elemento.final {
            background-color: #3498db; 
            color: white;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.9);
        }
        
        /* Animaci√≥n ENQUEUE: El elemento nuevo llega desde fuera por la derecha */
        .elemento.entrando {
            transform: translateX(100%); 
            opacity: 0;
            transition: none !important;
        }

        /* Animaci√≥n DEQUEUE: Sale por la izquierda */
        .elemento.saliendo {
            transition: transform 0.4s ease-in, opacity 0.4s ease-in, background-color 0.4s, width 0.4s, margin 0.4s;
            background-color: #e74c3c;
            transform: translateX(-100%) scale(0.9); 
            opacity: 0;
        }

        /* Animaci√≥n FRONT: Resaltado */
        .elemento.front-resaltado {
            animation: front-bounce 0.4s ease-in-out;
        }
        
        @keyframes front-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* --- Flechas Indicadoras: NUEVA POSICI√ìN LATERAL --- */
        .indicador-frente, .indicador-final {
            position: absolute;
            top: 50%; /* Centrado verticalmente */
            transform: translateY(-50%); /* Ajuste de centrado */
            opacity: 0;
            transition: all 0.4s ease-in-out;
            font-weight: 700;
            font-size: 1.1em;
            display: flex;
            flex-direction: column;
            align-items: center;
            white-space: nowrap; /* Evita que el texto se rompa */
            z-index: 10;
            padding: 5px;
        }
        
        /* Indicador del Frente (Izquierda) */
        .indicador-frente {
            left: -120px; /* Mover completamente fuera del contenedor de la cola */
            color: #e74c3c; 
        }
        
        /* Indicador del Final (Derecha) */
        .indicador-final {
            right: -120px; /* Mover completamente fuera del contenedor de la cola */
            color: #3498db; 
        }
        
        .indicador-frente.visible, .indicador-final.visible {
            opacity: 1;
        }
        
        .indicador-frente span, .indicador-final span {
            font-size: 30px;
        }
        
        .indicador-frente .text, .indicador-final .text {
            font-size: 0.9em;
            margin-top: -5px;
        }

        /* Alineaci√≥n del contenido del indicador */
        .indicador-frente {
            align-items: flex-end;
            text-align: right;
        }
        
        .indicador-final {
            align-items: flex-start;
            text-align: left;
        }

        /* Contenedor del elemento extra√≠do (para la animaci√≥n DEQUEUE) */
        #elemento-extraido-display {
            background-color: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            text-align: center;
            margin-top: 20px;
            font-weight: 700;
            min-height: 40px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #elemento-extraido-display.visible {
            opacity: 1;
        }
        
        /* --- Controles y Botones (Mantenidos) --- */
        .control-group {
            margin-bottom: 25px; 
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        button:disabled {
            background-color: #95a5a6 !important;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* --- Registro de Operaciones (Log) --- */
        #log-container {
            background-color: #fdfdfd;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 250px; 
            overflow-y: auto; 
            margin-top: 30px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #log-container h3 {
            font-family: 'Montserrat', sans-serif;
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        #log-list {
            list-style: none;
            padding: 0;
            font-size: 0.95em;
        }

        #log-list li {
            padding: 8px 10px;
            margin-bottom: 5px;
            border-left: 4px solid #3498db;
            background-color: #f9f9f9;
            border-radius: 4px;
            transition: all 0.2s;
        }

        #log-list li.error {
            border-left-color: #e74c3c;
            background-color: #fef1f1;
            font-weight: 700;
        }

        #log-list li.success {
            border-left-color: #2ecc71;
            background-color: #f0fff0;
        }
        
        /* Estilos generales de botones, inputs, etc. (se mantienen) */
        .control-group.capacidad {
            border: 2px dashed #aed6f1; 
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 35px;
            background-color: #f0f8ff; 
        }

        input[type="number"],
        input[type="text"] {
            flex-grow: 1;
            padding: 13px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 1.05em;
        }
        
        button {
            padding: 14px 22px; 
            border-radius: 6px;
            border: none;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        button.limpiar-btn {
            background-color: #e74c3c; 
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        #estado-cola {
            text-align: center;
            margin-top: 30px;
            font-size: 1.15em;
            padding: 20px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            background-color: #fefefe;
            box-shadow: inset 0 1px 5px rgba(0,0,0,0.05);
            font-weight: 500;
        }

        #estado-cola span {
            font-weight: 700;
            color: #3498db;
        }

        #estado-cola #frente-valor {
            color: #e74c3c;
        }

        #estado-cola #final-valor {
            color: #3498db;
        }

        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            color: #7f8c8d;
            border-top: 1px solid #dcdcdc;
            font-size: 0.95em;
            background-color: #ffffff;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <header>
        <h1>Cola: Filas üö¶ (FIFO)</h1>
        <p>Un modelo interactivo para comprender la estructura de datos Primero en Entrar, Primero en Salir.</p>
    </header>

    <section class="teoria-container">
        <h2 class="section-title">Concepto Fundamental: Cola (Queue)</h2>
        <p>Una Cola es una estructura de datos lineal que sigue el principio FIFO (First-In, First-Out - Primero en Entrar, Primero en Salir). Esto significa que el primer elemento a√±adido es siempre el primero en ser procesado y eliminado. </p>
        <p>Imag√≠nela como una fila de personas esperando un servicio: la persona que llega primero (el Frente) es la que es atendida primero, y las nuevas personas se unen al final de la fila (el Final).</p>
        
        <hr>
        
        <h3 class="section-title-sub">‚öôÔ∏è Operaciones Principales</h3>
        <div class="conceptos-grid">
            
            <div class="concepto-card">
                <h4>‚ûï ENQUEUE (Encolar)</h4>
                <p>Operaci√≥n para a√±adir un nuevo elemento por el Final de la cola. El elemento m√°s reciente siempre se une al final de la fila.</p>
            </div>
            
            <div class="concepto-card">
                <h4>‚ûñ DEQUEUE (Desencolar)</h4>
                <p>Operaci√≥n para eliminar y devolver el elemento que se encuentra en el Frente de la cola (el que ha esperado m√°s tiempo).</p>
            </div>
            
            <div class="concepto-card">
                <h4>üëÅÔ∏è FRONT (Ver Frente)</h4>
                <p>Permite ver el elemento que est√° en el Frente de la cola sin eliminarlo.</p>
            </div>
        </div>

        <h3 class="section-title-sub">‚ö†Ô∏è Estados y Errores</h3>
        <div class="conceptos-grid">
            <div class="concepto-card error-card">
                <h4>üõë Overflow (Desbordamiento)</h4>
                <p>Error que ocurre cuando se intenta realizar una operaci√≥n ENQUEUE en una cola que ya ha alcanzado su capacidad m√°xima.</p>
            </div>
            
            <div class="concepto-card error-card">
                <h4>‚õî Underflow (Subdesbordamiento)</h4>
                <p>Error que ocurre cuando se intenta realizar una operaci√≥n DEQUEUE o FRONT en una cola que se encuentra completamente vac√≠a.</p>
            </div>
        </div>
    </section>

    <main>
        <section class="visualizador">
            <h2 class="section-title">Visualizaci√≥n Din√°mica</h2>
            <div class="cola-wrapper">
                <div id="indicador-frente" class="indicador-frente">
                    <span>‚û°Ô∏è</span>
                    <span class="text">FRENTE (DEQUEUE)</span>
                </div>
                <div id="indicador-final" class="indicador-final">
                    <span>‚¨ÖÔ∏è</span>
                    <span class="text">FINAL (ENQUEUE)</span>
                </div>
                
                <div id="cola-contenedor" class="cola">
                    <div id="cola-contenedor-interno">
                        </div>
                </div>
            </div>
            
            <div id="estado-cola">
                <p>Tama√±o Actual: <span id="contador">0</span> / <span id="max-capacidad">5</span></p>
                <p>Elemento en el Frente (FRONT): <span id="frente-valor">N/A</span></p>
                <p>Elemento en el Final: <span id="final-valor">N/A</span></p>
                <div id="elemento-extraido-display"></div>
            </div>
            
            <div id="mensajes-error" class="error-box"></div>
        </section>

        <section class="controles">
            <h2 class="section-title">Panel de Control</h2>
            
            <div class="control-group capacidad">
                <label for="tamanio-cola">Definir Capacidad M√°xima (1-10)</label>
                <input type="number" id="tamanio-cola" placeholder="Ej: 7" min="1" max="10" value="5">
                <button onclick="setMaxSize()" id="btn-set-size">üíæ Definir Capacidad</button>
            </div>
            
            <div class="control-group">
                <input type="text" id="valor-entrada" placeholder="Valor a Encolar (ENQUEUE)" maxlength="10">
                <button onclick="enqueueElemento()" id="btn-enqueue">‚ûï ENQUEUE</button>
            </div>

            <div class="control-group">
                <button onclick="dequeueElemento()" id="btn-dequeue">‚ûñ DEQUEUE</button>
                <button onclick="frontElemento()" id="btn-front">üëÅÔ∏è FRONT (Ver Frente)</button>
            </div>
            
            <div class="control-group limpiar">
                <button onclick="limpiarCola()" class="limpiar-btn" id="btn-limpiar">üóëÔ∏è Limpiar Cola</button>
            </div>

            <hr>
            
            <div id="log-container">
                <h3>üìù Registro de Operaciones</h3>
                <ul id="log-list">
                    </ul>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Objeto Multimedia Interactivo. Estructuras de Datos. Todos los derechos reservados.
        </p>
        <p>por: Julian Jimenez Villase√±or DSM-42</p>
    </footer>

    <script>
        // --- JavaScript (L√≥gica) ---
        let MAX_SIZE = 5; 
        let cola = [];
        let isAnimating = false;

        // Elementos DOM
        const colaContenedor = document.getElementById('cola-contenedor');
        const colaInterno = document.getElementById('cola-contenedor-interno'); 
        const indicadorFrente = document.getElementById('indicador-frente');
        const indicadorFinal = document.getElementById('indicador-final');
        const valorEntrada = document.getElementById('valor-entrada');
        const contadorElemento = document.getElementById('contador');
        const frenteValorElemento = document.getElementById('frente-valor');
        const finalValorElemento = document.getElementById('final-valor');
        const maxCapacidadElemento = document.getElementById('max-capacidad');
        const tamanioColaInput = document.getElementById('tamanio-cola');
        const mensajesError = document.getElementById('mensajes-error');
        const logList = document.getElementById('log-list');
        const elementoExtraidoDisplay = document.getElementById('elemento-extraido-display');
        
        // Constantes de dise√±o
        const INITIAL_ELEMENT_WIDTH = 80; // Ancho base de la caja
        const ELEMENT_MARGIN = 5; // Margen a cada lado (total 10px)
        const CONTAINER_PADDING = 5; // Padding del contenedor cola (total 10px)
        const MAX_ELEMENTS = 10; 
        const ANIMATION_DURATION = 400; 

        let errorTimeout;
        let indicadorTimeout;
        
        // Funci√≥n para manejar el estado de los botones durante las animaciones
        function toggleControls(disable) {
            isAnimating = disable;
            document.querySelectorAll('button').forEach(button => {
                if (button.id !== 'btn-limpiar' && button.id !== 'btn-set-size') {
                    button.disabled = disable;
                }
            });
            valorEntrada.disabled = disable;
        }

        // Funci√≥n para agregar un mensaje al registro de operaciones
        function logOperation(mensaje, tipo = 'info') {
            const li = document.createElement('li');
            li.textContent = mensaje;
            
            if (tipo === 'error') {
                li.classList.add('error');
            } else if (tipo === 'success') {
                li.classList.add('success');
            }
            
            logList.insertBefore(li, logList.firstChild);
            
            while (logList.children.length > 20) {
                logList.removeChild(logList.lastChild);
            }
        }
        
        // Funci√≥n clave para calcular y aplicar el ancho de los elementos
        function ajustarAnchoElementos(elementCount) {
            // Utilizamos la capacidad m√°xima como base para calcular el ancho y que no salte al hacer ENQUEUE/DEQUEUE
            const baseCount = MAX_SIZE; 
            const containerWidth = colaContenedor.clientWidth - (CONTAINER_PADDING * 2);
            
            // Si hay 5 o menos elementos, usamos el ancho inicial.
            if (baseCount <= 5) {
                return INITIAL_ELEMENT_WIDTH; 
            }
            
            // Calcular el ancho total necesario para los m√°rgenes
            const totalMarginWidth = (baseCount * 2 * ELEMENT_MARGIN);
            
            // Ancho disponible para las cajas de los elementos
            const availableWidth = containerWidth - totalMarginWidth;
            
            // Ancho nuevo para cada elemento
            let newElementWidth = Math.floor(availableWidth / baseCount);
            
            if (newElementWidth < 40) {
                 newElementWidth = 40; 
            }
            
            return newElementWidth;
        }


        function setMaxSize() {
            if (cola.length > 0) {
                mostrarMensaje("No puedes cambiar el tama√±o de la cola mientras contenga elementos. Usa 'Limpiar Cola' primero.", true);
                tamanioColaInput.value = MAX_SIZE; 
                return;
            }
            
            const nuevoTamanio = parseInt(tamanioColaInput.value);
            
            if (isNaN(nuevoTamanio) || nuevoTamanio < 1 || nuevoTamanio > MAX_ELEMENTS) {
                mostrarMensaje(`Capacidad inv√°lida. Debe ser un n√∫mero entre 1 y ${MAX_ELEMENTS}.`, true);
                tamanioColaInput.value = MAX_SIZE;
                return;
            }

            MAX_SIZE = nuevoTamanio;
            maxCapacidadElemento.textContent = MAX_SIZE;
            
            // Forzar actualizaci√≥n para aplicar el nuevo ancho si MAX_SIZE es grande
            actualizarVisualizacion(true); 

            logOperation(`Capacidad m√°xima definida a ${nuevoTamanio}.`);
            mostrarMensaje(`Capacidad definida a ${nuevoTamanio}.`, false);
        }

        function limpiarCola() {
            if (cola.length === 0) {
                 logOperation("La cola ya est√° vac√≠a.", 'info');
                 return;
            }
            
            toggleControls(true); 
            
            const elementosVisuales = colaInterno.querySelectorAll('.elemento');
            
            // Animaci√≥n de salida masiva hacia la izquierda
            elementosVisuales.forEach((el, index) => {
                setTimeout(() => {
                    el.classList.add('saliendo'); 
                }, index * 50); 
            });

            cola = [];
            
            setTimeout(() => {
                // Reiniciar el contenedor
                colaInterno.style.transform = `translateX(0px)`;
                actualizarVisualizacion(true); 
                logOperation("‚úÖ Cola limpiada exitosamente.", 'success');
                toggleControls(false); 
            }, elementosVisuales.length * 50 + ANIMATION_DURATION); 
        }

        function limpiarIndicadores() {
            clearTimeout(indicadorTimeout); 
            indicadorFrente.classList.remove('visible');
            indicadorFinal.classList.remove('visible');
        }

        function limpiarFrontVisual() {
            colaInterno.querySelectorAll('.elemento').forEach(el => el.classList.remove('frente', 'final', 'front-resaltado'));
        }

        function actualizarVisualizacion(forzarRedibujo = false) {
            contadorElemento.textContent = cola.length;
            
            limpiarIndicadores(); 
            limpiarFrontVisual();

            // Determinar el ancho de los elementos basado en MAX_SIZE
            const elementWidth = ajustarAnchoElementos(MAX_SIZE);

            if (forzarRedibujo) {
                colaInterno.innerHTML = ''; 
                // A√±adir todos los elementos de la cola en el orden correcto (FIFO)
                cola.forEach((item) => {
                    const divElemento = document.createElement('div');
                    divElemento.className = 'elemento';
                    divElemento.textContent = item;
                    // Aplicar el ancho calculado
                    divElemento.style.width = `${elementWidth}px`;
                    divElemento.style.minWidth = `${elementWidth}px`;
                    divElemento.style.lineHeight = `${elementWidth - 10}px`; // Ajustar texto verticalmente
                    colaInterno.appendChild(divElemento); 
                });
            } else {
                 // Si no hay redibujo completo, ajustar los anchos existentes
                 colaInterno.querySelectorAll('.elemento').forEach(divElemento => {
                    divElemento.style.width = `${elementWidth}px`;
                    divElemento.style.minWidth = `${elementWidth}px`;
                    divElemento.style.lineHeight = `${elementWidth - 10}px`;
                 });
            }
            
            const elementosVisuales = colaInterno.querySelectorAll('.elemento');

            if (cola.length > 0) {
                // Actualizar estado de Frente y Final
                const frenteValue = cola[0];
                frenteValorElemento.textContent = frenteValue;
                elementosVisuales[0].classList.add('frente');
                
                const finalValue = cola[cola.length - 1];
                finalValorElemento.textContent = finalValue;
                elementosVisuales[cola.length - 1].classList.add('final');

                if (cola.length === 1) {
                    elementosVisuales[0].classList.add('final'); 
                } else {
                    elementosVisuales[0].classList.remove('final');
                }
                
                // Mostrar indicadores
                indicadorFrente.classList.add('visible');
                indicadorFinal.classList.add('visible');

            } else {
                frenteValorElemento.textContent = 'N/A';
                finalValorElemento.textContent = 'N/A';
            }
            
            // Eliminar cualquier transformaci√≥n de desplazamiento (para asegurar visualizaci√≥n completa)
             colaInterno.style.transform = `translateX(0px)`;
        }

        function mostrarMensaje(mensaje, esError = true) {
            clearTimeout(errorTimeout); 
            mensajesError.textContent = mensaje;
            mensajesError.style.backgroundColor = esError ? '#e74c3c' : '#27ae60'; 
            
            errorTimeout = setTimeout(() => {
                mensajesError.textContent = '';
                mensajesError.style.backgroundColor = 'transparent';
            }, 3000);
        }

        // --- OPERACIONES PRINCIPALES con Animaciones ---

        function enqueueElemento() {
            if (isAnimating) return;
            toggleControls(true);
            
            const valor = valorEntrada.value.trim();
            if (!valor) {
                mostrarMensaje("Por favor, introduce un valor antes de encolar.", true);
                toggleControls(false);
                return;
            }

            // --- Desbordamiento (Overflow) ---
            if (cola.length >= MAX_SIZE) {
                const mensaje = `üõë ERROR (Overflow). ENQUEUE fallido. La cola est√° llena (M√°x: ${MAX_SIZE}).`;
                mostrarMensaje(mensaje, true);
                logOperation(mensaje, 'error');
                toggleControls(false);
                return;
            }
            
            // 1. Agrega el valor a la estructura de datos JS
            cola.push(valor);

            // 2. Determinar el ancho de los elementos (usando MAX_SIZE)
            const elementWidth = ajustarAnchoElementos(MAX_SIZE);
            
            // 3. Crea el elemento visual y lo prepara para la animaci√≥n de entrada
            const divElemento = document.createElement('div');
            divElemento.className = 'elemento entrando';
            divElemento.textContent = valor;
            divElemento.style.width = `${elementWidth}px`;
            divElemento.style.minWidth = `${elementWidth}px`;
            divElemento.style.lineHeight = `${elementWidth - 10}px`;

            // 4. Insertar en el contenedor interno
            colaInterno.appendChild(divElemento);
            
            // 5. Ajustar todos los anchos para acomodar el nuevo elemento (usando la misma l√≥gica)
            colaInterno.querySelectorAll('.elemento').forEach(el => {
                 el.style.width = `${elementWidth}px`;
                 el.style.minWidth = `${elementWidth}px`;
                 el.style.lineHeight = `${elementWidth - 10}px`;
            });
            
            // 6. Inicia la animaci√≥n de entrada
            setTimeout(() => {
                divElemento.classList.remove('entrando');
                actualizarVisualizacion();
                logOperation(`‚ûï ENQUEUE: Elemento "${valor}" a√±adido al Final.`, 'success');
                toggleControls(false);
                
            }, 50); 
            
            valorEntrada.value = '';
        }

        function dequeueElemento() {
            if (isAnimating) return;
            toggleControls(true);

            // --- Subdesbordamiento (Underflow) ---
            if (cola.length === 0) {
                const mensaje = "‚õî ERROR (Underflow). DEQUEUE fallido. La cola est√° vac√≠a.";
                mostrarMensaje(mensaje, true);
                logOperation(mensaje, 'error');
                toggleControls(false);
                return;
            }

            // FIFO: Eliminar el primer elemento (√≠ndice 0)
            const elementoDesencolado = cola.shift(); 
            limpiarIndicadores(); 
            
            // El elemento visual a desencolar es el primero (Frente)
            const elementoVisual = colaInterno.querySelector('.elemento');
            
            if (elementoVisual) {
                // Muestra el elemento extra√≠do en el display
                elementoExtraidoDisplay.textContent = `Extra√≠do (DEQUEUE): ${elementoDesencolado}`;
                elementoExtraidoDisplay.classList.add('visible');

                // 1. Aplica la animaci√≥n de salida
                elementoVisual.classList.add('saliendo');
                elementoVisual.classList.remove('frente', 'final'); 
                
                // 2. Determinar el nuevo ancho de los elementos restantes
                const newElementWidth = ajustarAnchoElementos(MAX_SIZE);
                
                // 3. Ajustar todos los anchos restantes para que ocupen el nuevo espacio
                colaInterno.querySelectorAll('.elemento:not(.saliendo)').forEach(el => {
                     el.style.width = `${newElementWidth}px`;
                     el.style.minWidth = `${newElementWidth}px`;
                     el.style.lineHeight = `${newElementWidth - 10}px`;
                });

                // 4. Elimina el elemento visual despu√©s de que la animaci√≥n termine
                setTimeout(() => {
                    elementoVisual.remove();
                    actualizarVisualizacion(false); 
                    
                    logOperation(`‚ûñ DEQUEUE: Elemento "${elementoDesencolado}" eliminado del Frente.`, 'success');
                    
                    // Oculta el display de extra√≠do
                    elementoExtraidoDisplay.classList.remove('visible');
                    elementoExtraidoDisplay.textContent = '';
                    
                    toggleControls(false);
                }, ANIMATION_DURATION); 
            }
        }

        function frontElemento() {
            if (isAnimating) return;

            // --- Subdesbordamiento (Underflow) ---
            if (cola.length === 0) {
                const mensaje = "‚õî ERROR (Underflow). FRONT fallido. La cola est√° vac√≠a.";
                limpiarIndicadores();
                mostrarMensaje(mensaje, true);
                logOperation(mensaje, 'error');
                return;
            }

            const frente = cola[0]; 
            const elementoVisualFrente = colaInterno.querySelector('.elemento.frente'); 
            
            if (elementoVisualFrente) {
                // 1. Aplica la animaci√≥n de rebote/resaltado
                elementoVisualFrente.classList.add('front-resaltado');
                
                // 2. Muestra los indicadores
                indicadorFrente.classList.add('visible');
                indicadorFinal.classList.add('visible'); 

                // 3. Limpia el temporizador anterior y establece uno nuevo
                clearTimeout(indicadorTimeout);
                indicadorTimeout = setTimeout(() => {
                    elementoVisualFrente.classList.remove('front-resaltado');
                    actualizarVisualizacion(false); 
                }, 1500); 
            }

            logOperation(`üëÅÔ∏è FRONT: El elemento en el Frente es "${frente}".`, 'info');
            mostrarMensaje(`El elemento en el Frente (FRONT) es: "${frente}".`, false);
        }

        // Inicializar la visualizaci√≥n al cargar la p√°gina
        window.onload = () => {
            setMaxSize(); 
            actualizarVisualizacion(true); 
            logOperation("Visualizador de Cola cargado y listo para usar. ¬°Comienza con ENQUEUE!", 'info');
            toggleControls(false); 
            
            // Asegurar que se recalcula el tama√±o al cargar la ventana
            window.addEventListener('resize', () => actualizarVisualizacion(false));
        };
    </script>
</body>
</html>